<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="canonical" type="text/html" href="https://kube-logging.dev/4.10/docs/operation/">
<link rel="alternate" type="text/releases" href="https://kube-logging.dev/4.10/docs/operation/releases.releases">
<meta name="robots" content="noindex, nofollow">
<link rel="shortcut icon" href="/4.10/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/4.10/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/4.10/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/4.10/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/4.10/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/4.10/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/4.10/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/4.10/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/4.10/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/4.10/favicons/android-192x192.png" sizes="192x192">
<title>Operation | Logging operator</title><meta name="description" content="Documentation for the Logging operator">
<meta property="og:title" content="Operation">
<meta property="og:description" content="Documentation for the Logging operator">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kube-logging.dev/4.10/docs/operation/"><meta property="og:site_name" content="Logging operator">
<meta itemprop="name" content="Operation">
<meta itemprop="description" content="Documentation for the Logging operator"><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Operation">
<meta name="twitter:description" content="Documentation for the Logging operator">
<link rel="preload" href="/4.10/scss/main.min.86aacb60bddeb293329df2c5300c7ccbb0b5b5c79006869829b192179e011aef.css" as="style">
<link href="/4.10/scss/main.min.86aacb60bddeb293329df2c5300c7ccbb0b5b5c79006869829b192179e011aef.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/4.10/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
<link rel="canonical" href="https://kube-logging.dev/docs/operation/">
<script src="/pagefind/pagefind-highlight.js" type="application/x-javascript"></script>
<script type="module">
        await import('/pagefind/pagefind-highlight.js');
        new PagefindHighlight({ highlightParam: "highlight" });
    </script>
<script>window.__SJ_MESSAGE__="We collect cookies to analyze our website traffic and performance. We never collect any personal data.",window.__SJ_ACCEPT_BTN_TEXT__="Accept",window.__SJ_REJECT_BTN_TEXT__="Reject"</script>
<script src="https://cdn.jsdelivr.net/gh/sprucejoy/cookie-consent-autoblock-gdpr/cookie-consent.js" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LM8C8QXCN7"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LM8C8QXCN7")}</script>
</head><body class="td-section">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/4.10/"><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 3237.738 490.023" id="svg142" sodipodi:docname="logo-new2.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs146"/><sodipodi:namedview id="namedview144" pagecolor="#505050" bordercolor="#ffffff" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#505050" showgrid="false" inkscape:zoom=".37340884" inkscape:cx="1620.208" inkscape:cy="243.70071" inkscape:window-width="705" inkscape:window-height="480" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="svg142"/><g id="Group_2068" data-name="Group 2068" transform="translate(-43577.297 -34456.625)"><g id="Group_2067" data-name="Group 2067" transform="translate(27723.789 24565.273)"><path id="Path_4217" data-name="Path 4217" d="M47842.219 34024.414l-276.027 475.07h71.242l240.227-414.1z" transform="translate(-31703.996 -24123.111)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4218" data-name="Path 4218" d="M47831.324 34080.781l166.754 287.355h-333.035z" transform="translate(-31640.254 -24086.76)" fill="#fff" stroke="#fff" stroke-width="10"/><path id="Path_4220" data-name="Path 4220" d="M47668.742 34274.2l-37.727 64.1h442.43l-37.156-64.1z" transform="translate(-31662.199 -23962.018)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4222" data-name="Path 4222" d="M11294.989 10157.944l311.97-.01-156.218-269.074-78.621 135.83z" transform="translate(4740.338 117.39)" fill="#fff"/><path id="Path_4224" data-name="Path 4224" d="M47787.594 34159.125l-54.391 93.035h108.039z" transform="translate(-31596.297 -24036.238)" fill="#13142c" stroke="#13132d" stroke-width="10"/></g><text id="Logging_Operator" data-name="Logging Operator" transform="translate(45475.035 34799.609)" fill="#fff" font-size="267" font-family="Montserrat-Bold, Montserrat" font-weight="700" letter-spacing=".046em"><tspan x="-1339.806" y="0" id="tspan138">Logging Operator</tspan></text></g></svg></span><span class="navbar-brand__name">Logging operator</span>
<span class="font-weight-bold navbar-logo navbar-version">4.10.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/kube-logging/logging-operator" title="Go to GitHub project page" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/4.10/docs/" title="Read the documentation"><span>Documentation</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/4.10/docs/community/" title="Come chat with us!"><span>Community</span></a>
</li><li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
<div w3-include-html="/docs/operation//releases.releases" w3-include-html-default='<a class="dropdown-item" href="/docs/releases.releases">Latest</a>'></div><script type="application/x-javascript">w3.includeHTML()</script>
</div></li></ul></div><div class="navbar-nav d-none d-lg-block">
<div class="main-menu-search">
<a href="/search">
<span class="nav-link"><i class="fa fa-search" aria-hidden="true"></i> Search</span>
</a>
</div></div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href="/4.10/docs/operation/">Return to the regular view of this page</a>.
</p></div><h1 class="title">Operation</h1><ul>
<li>1: <a href="#pg-85dfc8f2bc8d8124c30cdb1fdddb3b6c">Logging operator troubleshooting</a></li><ul>
<li>1.1: <a href="#pg-741171b799e509ff0eabf397d862c757">Troubleshooting Fluent Bit</a></li><li>1.2: <a href="#pg-08d978e8b4bd5dff112fd9e079aaba48">Troubleshooting Fluentd</a></li><li>1.3: <a href="#pg-3f9ff6b76f6626e8e1fb3f91c1ad7b0f">Troubleshooting syslog-ng</a></li><li>1.4: <a href="#pg-ff4769d67e22b03ee37bf3b31cd60c80">Running on KinD</a></li></ul><li>2: <a href="#pg-f43e816fa3bb01ec74b11406f7aa77ce">Monitor your logging pipeline with Prometheus Operator</a></li><li>3: <a href="#pg-362f849752620b4cf0d070e2fc884699">Alerting</a></li><li>4: <a href="#pg-e1b978ea58e795d55d2b6d7ad7aabb23">Readiness probe</a></li><li>5: <a href="#pg-791b523329c1485057fb827f9ed4b80b">Collect Fluentd errors</a></li><li>6: <a href="#pg-5ac19d15e22096d860ccfc7422b529f9">Optimization</a></li><li>7: <a href="#pg-af5ba8326f5b4c35d5dc6de4337c19b0">Scaling</a></li><li>8: <a href="#pg-2ea22a017fd9fef2575c36200cd7f9b8">CPU and memory requirements</a></li></ul><div class="content">
</div></div><div class="td-content">
<h1 id="pg-85dfc8f2bc8d8124c30cdb1fdddb3b6c">1 - Logging operator troubleshooting</h1><p align="center"><img src="/docs/img/troubleshooting.svg" alt="Logo" width="260"></p><p align="center">
<p>The following tips and commands can help you to troubleshoot your Logging operator installation.</p><h2 id="first-things-to-do">First things to do</h2><ol>
<li>
<p>Check that the necessary CRDs are installed. Issue the following command: <code>kubectl get crd</code>
The output should include the following CRDs:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>clusterflows.logging.banzaicloud.io     2019-12-05T15:11:48Z
</span></span><span style="display:flex"><span>clusteroutputs.logging.banzaicloud.io   2019-12-05T15:11:48Z
</span></span><span style="display:flex"><span>flows.logging.banzaicloud.io            2019-12-05T15:11:48Z
</span></span><span style="display:flex"><span>loggings.logging.banzaicloud.io         2019-12-05T15:11:48Z
</span></span><span style="display:flex"><span>outputs.logging.banzaicloud.io          2019-12-05T15:11:48Z
</span></span></code></pre></div></li><li>
<p>Verify that the Logging operator pod is running. Issue the following command: <code>kubectl get pods |grep logging-operator</code>
The output should include the a running pod, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                                          READY   STATUS      RESTARTS   AGE
</span></span><span style="display:flex"><span>logging-demo-log-generator-6448d45cd9-z7zk8   1/1     Running     <span style="color:#0000cf;font-weight:700">0</span>          24m
</span></span></code></pre></div></li><li>
<p>Check the status of your resources. Beginning with Logging Operator 3.8, all custom resources have a <code>Status</code> and a <code>Problems</code> field. In a healthy system, the Problems field of the resources is empty, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get clusteroutput -A
</span></span></code></pre></div><p>Sample output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAMESPACE   NAME      ACTIVE   PROBLEMS
</span></span><span style="display:flex"><span>default     nullout   <span style="color:#204a87">true</span>
</span></span></code></pre></div><p>The <code>ACTIVE</code> column indicates that the <code>ClusterOutput</code> has successfully passed the <code>configcheck</code> and presented it in the current fluentd configuration. When no errors are reported the <code>PROBLEMS</code> column is empty.</p><p>Take a look at another example, in which we have an incorrect <code>ClusterFlow</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get clusterflow -o wide
</span></span></code></pre></div><p>Sample output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME      ACTIVE   PROBLEMS
</span></span><span style="display:flex"><span>all-log   <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>nullout   <span style="color:#204a87">false</span>    <span style="color:#0000cf;font-weight:700">1</span>
</span></span></code></pre></div><p>You can see that the <strong>nullout</strong> <code>Clusterflow</code> is inactive and there is <em>1</em> problem with the configuration. To display the problem, check the <code>status</code> field of the object, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get clusterflow nullout -o<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#39;{.status}&#39;</span> <span style="color:#000;font-weight:700">|</span> jq
</span></span></code></pre></div><p>Sample output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span><span style="color:#4e9a06">&#34;active&#34;</span>: false,
</span></span><span style="display:flex"><span><span style="color:#4e9a06">&#34;problems&#34;</span>: <span style="color:#ce5c00;font-weight:700">[</span>
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;dangling global output reference: nullout2&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">]</span>,
</span></span><span style="display:flex"><span><span style="color:#4e9a06">&#34;problemsCount&#34;</span>: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">}</span>
</span></span></code></pre></div></li></ol><p>After that, check the following sections for further tips.</p><h2 id="getting-support">Getting Support</h2><p>If you encounter any problems that the documentation does not address, <a href="https://github.com/kube-logging/logging-operator/issues">file an issue</a> or talk to us on <a href="https://discord.gg/9ACY4RDsYN">Discord</a> or on the <a href="/4.10/docs/community/">CNCF Slack</a>.</p><p>Before asking for help, prepare the following information to make troubleshooting faster:</p><ul>
<li>Logging operator version</li><li>kubernetes version</li><li>helm/chart version (if you installed the Logging operator with helm)</li><li>Logging operator logs</li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#check-fluentd-configuration">fluentd configuration</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#get-fluentd-logs">fluentd logs</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentbit/#check-the-fluent-bit-configuration">fluentbit configuration</a></li><li>fluentbit logs</li></ul><p>Do not forget to remove any sensitive information (for example, passwords and private keys) before sharing.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-741171b799e509ff0eabf397d862c757">1.1 - Troubleshooting Fluent Bit</h1><p align="center"><img src="/docs/img/fluentbit.png" alt="Fluent Bit logo" height="100"></p><p>The following sections help you troubleshoot the Fluent Bit component of the Logging operator.</p><h2 id="check-the-fluent-bit-daemonset">Check the Fluent Bit daemonset</h2><p>Verify that the Fluent Bit daemonset is available. Issue the following command: <code>kubectl get daemonsets</code>
The output should include a Fluent Bit daemonset, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
</span></span><span style="display:flex"><span>logging-demo-fluentbit   <span style="color:#0000cf;font-weight:700">1</span>         <span style="color:#0000cf;font-weight:700">1</span>         <span style="color:#0000cf;font-weight:700">1</span>       <span style="color:#0000cf;font-weight:700">1</span>            <span style="color:#0000cf;font-weight:700">1</span>           &lt;none&gt;          110s
</span></span></code></pre></div><h2 id="check-the-fluent-bit-configuration">Check the Fluent Bit configuration</h2><p>You can display the current configuration of the Fluent Bit daemonset using the following command:
<code>kubectl get secret logging-demo-fluentbit -o jsonpath="{.data['fluent-bit\.conf']}" | base64 --decode</code></p><p>The output looks like the following:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#000;font-weight:700">[</span><span style="color:#000">SERVICE]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Flush        1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Daemon       Off</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Log_Level    info</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Parsers_File parsers.conf</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">storage.path  /buffers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:700">[</span><span style="color:#000">INPUT]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Name         tail</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">DB  /tail-db/tail-containers-state.db</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Mem_Buf_Limit  5MB</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Parser  docker</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Path  /var/log/containers/*.log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Refresh_Interval  5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Skip_Long_Lines  On</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Tag  kubernetes.*</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:700">[</span><span style="color:#000">FILTER]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Name        kubernetes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Kube_CA_File  /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Kube_Tag_Prefix  kubernetes.var.log.containers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Kube_Token_File  /var/run/secrets/kubernetes.io/serviceaccount/token</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Kube_URL  https://kubernetes.default.svc:443</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Match  kubernetes.*</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Merge_Log  On</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:700">[</span><span style="color:#000">OUTPUT]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Name          forward</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Match         *</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Host          logging-demo-fluentd.logging.svc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Port          24240</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tls           On</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tls.verify    Off</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tls.ca_file   /fluent-bit/tls/ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tls.crt_file  /fluent-bit/tls/tls.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tls.key_file  /fluent-bit/tls/tls.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Shared_Key    Kamk2_SukuWenk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">Retry_Limit   False</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="debug-version-of-the-fluentbit-container">Debug version of the fluentbit container</h2><p>All Fluent Bit image tags have a debug version marked with the <code>-debug</code> suffix. You can install this debug version using the following command:
<code>kubectl edit loggings.logging.banzaicloud.io logging-demo</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">fluentbit</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">pullPolicy</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">repository</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fluent/fluent-bit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">tag</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1.3.2</span>-<span style="color:#000">debug</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>After deploying the debug version, you can kubectl exec into the pod using <code>sh</code> and look around. For example: <code>kubectl exec -it logging-demo-fluentbit-778zg sh</code></p><h2 id="check-the-queued-log-messages">Check the queued log messages</h2><p>You can check the buffer directory if Fluent Bit is configured to buffer queued log messages to disk instead of in memory. (You can configure it through the InputTail fluentbit config, by setting the <code>storage.type</code> field to <code>filesystem</code>.)</p><p><code>kubectl exec -it logging-demo-fluentbit-9dpzg ls /buffers</code></p><h2 id="getting-support">Getting Support</h2><p>If you encounter any problems that the documentation does not address, <a href="https://github.com/kube-logging/logging-operator/issues">file an issue</a> or talk to us on <a href="https://discord.gg/9ACY4RDsYN">Discord</a> or on the <a href="/4.10/docs/community/">CNCF Slack</a>.</p><p>Before asking for help, prepare the following information to make troubleshooting faster:</p><ul>
<li>Logging operator version</li><li>kubernetes version</li><li>helm/chart version (if you installed the Logging operator with helm)</li><li>Logging operator logs</li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#check-fluentd-configuration">fluentd configuration</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#get-fluentd-logs">fluentd logs</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentbit/#check-the-fluent-bit-configuration">fluentbit configuration</a></li><li>fluentbit logs</li></ul><p>Do not forget to remove any sensitive information (for example, passwords and private keys) before sharing.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-08d978e8b4bd5dff112fd9e079aaba48">1.2 - Troubleshooting Fluentd</h1><p align="center"><img src="/docs/img/fluentd.png" alt="Fluentd logo" height="100"></p><p>The following sections help you troubleshoot the Fluentd statefulset component of the Logging operator.</p><h2 id="check-fluentd-pod-status-statefulset">Check Fluentd pod status (statefulset)</h2><p>Verify that the Fluentd statefulset is available using the following command: <code>kubectl get statefulsets</code></p><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                   READY   AGE
</span></span><span style="display:flex"><span>logging-demo-fluentd   1/1     1m
</span></span></code></pre></div><h2 id="configcheck">ConfigCheck</h2><p>The Logging operator has a builtin mechanism that validates the generated fluentd configuration before applying it to fluentd. You should be able to see the configcheck pod and its log output. The result of the check is written into the <code>status</code> field of the corresponding <code>Logging</code> resource.</p><p>In case the operator is stuck in an error state caused by a failed configcheck, restore the previous configuration by modifying or removing the invalid resources to the point where the configcheck pod is finally able to complete successfully.</p><h2 id="check-fluentd-configuration">Check Fluentd configuration</h2><p>Use the following command to display the configuration of Fluentd:
<code>kubectl get secret logging-demo-fluentd-app -o jsonpath="{.data['fluentd\.conf']}" | base64 --decode</code></p><p>The output should be similar to the following:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;source&gt;</span>
</span></span><span style="display:flex"><span>  @type forward
</span></span><span style="display:flex"><span>  @id main_forward
</span></span><span style="display:flex"><span>  bind 0.0.0.0
</span></span><span style="display:flex"><span>  port 24240
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;transport</span> <span style="color:#a40000">tls</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>    ca_path /fluentd/tls/ca.crt
</span></span><span style="display:flex"><span>    cert_path /fluentd/tls/tls.crt
</span></span><span style="display:flex"><span>    client_cert_auth true
</span></span><span style="display:flex"><span>    private_key_path /fluentd/tls/tls.key
</span></span><span style="display:flex"><span>    version TLSv1_2
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/transport&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;security&gt;</span>
</span></span><span style="display:flex"><span>    self_hostname fluentd
</span></span><span style="display:flex"><span>    shared_key Kamk2_SukuWenk
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/security&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;/source&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;match</span> <span style="color:#a40000">**</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>  @type label_router
</span></span><span style="display:flex"><span>  @id main_label_router
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;route&gt;</span>
</span></span><span style="display:flex"><span>    @label @427b3e18f3a3bc3f37643c54e9fc960b
</span></span><span style="display:flex"><span>    labels app.kubernetes.io/instance:logging-demo,app.kubernetes.io/name:log-generator
</span></span><span style="display:flex"><span>    namespace logging
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/route&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;/match&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;label</span> <span style="color:#a40000">@427b3e18f3a3bc3f37643c54e9fc960b</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;match</span> <span style="color:#a40000">kubernetes.**</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>    @type tag_normaliser
</span></span><span style="display:flex"><span>    @id logging-demo-flow_0_tag_normaliser
</span></span><span style="display:flex"><span>    format ${namespace_name}.${pod_name}.${container_name}
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/match&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;filter</span> <span style="color:#a40000">**</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>    @type parser
</span></span><span style="display:flex"><span>    @id logging-demo-flow_1_parser
</span></span><span style="display:flex"><span>    key_name log
</span></span><span style="display:flex"><span>    remove_key_name_field true
</span></span><span style="display:flex"><span>    reserve_data true
</span></span><span style="display:flex"><span>    <span style="color:#204a87;font-weight:700">&lt;parse&gt;</span>
</span></span><span style="display:flex"><span>      @type nginx
</span></span><span style="display:flex"><span>    <span style="color:#204a87;font-weight:700">&lt;/parse&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/filter&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;match</span> <span style="color:#a40000">**</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>    @type s3
</span></span><span style="display:flex"><span>    @id logging_logging-demo-flow_logging-demo-output-minio_s3
</span></span><span style="display:flex"><span>    aws_key_id WVKblQelkDTSKTn4aaef
</span></span><span style="display:flex"><span>    aws_sec_key LAmjIah4MTKTM3XGrDxuD2dTLLmysVHvZrtxpzK6
</span></span><span style="display:flex"><span>    force_path_style true
</span></span><span style="display:flex"><span>    path logs/${tag}/%Y/%m/%d/
</span></span><span style="display:flex"><span>    s3_bucket demo
</span></span><span style="display:flex"><span>    s3_endpoint http://logging-demo-minio.logging.svc.cluster.local:9000
</span></span><span style="display:flex"><span>    s3_region test_region
</span></span><span style="display:flex"><span>    <span style="color:#204a87;font-weight:700">&lt;buffer</span> <span style="color:#a40000">tag,time</span><span style="color:#204a87;font-weight:700">&gt;</span>
</span></span><span style="display:flex"><span>      @type file
</span></span><span style="display:flex"><span>      path /buffers/logging_logging-demo-flow_logging-demo-output-minio_s3.*.buffer
</span></span><span style="display:flex"><span>      retry_forever true
</span></span><span style="display:flex"><span>      timekey 10s
</span></span><span style="display:flex"><span>      timekey_use_utc true
</span></span><span style="display:flex"><span>      timekey_wait 0s
</span></span><span style="display:flex"><span>    <span style="color:#204a87;font-weight:700">&lt;/buffer&gt;</span>
</span></span><span style="display:flex"><span>  <span style="color:#204a87;font-weight:700">&lt;/match&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">&lt;/label&gt;</span>
</span></span></code></pre></div><h2 id="set-fluentd-log-level">Set Fluentd log Level</h2><p>Use the following command to change the log level of Fluentd.
<code>kubectl edit loggings.logging.banzaicloud.io logging-demo</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">logLevel</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">debug</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="get-fluentd-logs">Get Fluentd logs</h2><p>The following command displays the logs of the Fluentd container.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs -f logging-demo-fluentd-0 -c fluentd
</span></span></code></pre></div><blockquote>
<p>Fluentd logs were written to the container filesystem up until Logging operator version 4.3, which has been changed to stdout with 4.4.
See <a href="/4.10/docs/logging-infrastructure/fluentd/#fluentoutlogrotate">FluentOutLogrotate</a> why this was changed and how you can re-enable it if needed.</p></blockquote><blockquote>
<p>Tip: If the logs include the <code>error="can't create buffer file ...</code> error message, Fluentd can’t create the buffer file at the specified location. This can mean for example that the disk is full, the filesystem is read-only, or some other permission error. Check the buffer-related settings of your <a href="/4.10/docs/configuration/crds/v1beta1/fluentd_types/">Fluentd configuration</a>.</p></blockquote><h2 id="set-stdout-as-an-output">Set stdout as an output</h2><p>You can use an stdout filter at any point in the flow to dump the log messages to the stdout of the Fluentd container. For example:
<code>kubectl edit loggings.logging.banzaicloud.io logging-demo</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Flow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">exchange</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">filters</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">stdout</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">localOutputRefs</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">exchange</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">selectors</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">application</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">exchange</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="check-the-buffer-path-in-the-fluentd-container">Check the buffer path in the fluentd container</h2><p><code>kubectl exec -it logging-demo-fluentd-0 ls /buffers</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Defaulting container name to fluentd.
</span></span><span style="display:flex"><span>Use <span style="color:#4e9a06">&#39;kubectl describe pod/logging-demo-fluentd-0 -n logging&#39;</span> to see all of the containers in this pod.
</span></span><span style="display:flex"><span>logging_logging-demo-flow_logging-demo-output-minio_s3.b598f7eb0b2b34076b6da13a996ff2671.buffer
</span></span><span style="display:flex"><span>logging_logging-demo-flow_logging-demo-output-minio_s3.b598f7eb0b2b34076b6da13a996ff2671.buffer.meta
</span></span></code></pre></div><h2 id="getting-support">Getting Support</h2><p>If you encounter any problems that the documentation does not address, <a href="https://github.com/kube-logging/logging-operator/issues">file an issue</a> or talk to us on <a href="https://discord.gg/9ACY4RDsYN">Discord</a> or on the <a href="/4.10/docs/community/">CNCF Slack</a>.</p><p>Before asking for help, prepare the following information to make troubleshooting faster:</p><ul>
<li>Logging operator version</li><li>kubernetes version</li><li>helm/chart version (if you installed the Logging operator with helm)</li><li>Logging operator logs</li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#check-fluentd-configuration">fluentd configuration</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#get-fluentd-logs">fluentd logs</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentbit/#check-the-fluent-bit-configuration">fluentbit configuration</a></li><li>fluentbit logs</li></ul><p>Do not forget to remove any sensitive information (for example, passwords and private keys) before sharing.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-3f9ff6b76f6626e8e1fb3f91c1ad7b0f">1.3 - Troubleshooting syslog-ng</h1><p>The following sections help you troubleshoot the syslog-ng statefulset component of the Logging operator.</p><h2 id="check-syslog-ng-pod-status-statefulset">Check syslog-ng pod status (statefulset)</h2><p>Verify that the syslog-ng statefulset is available using the following command: <code>kubectl get statefulsets</code></p><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                   READY   AGE
</span></span><span style="display:flex"><span>logging-demo-syslog-ng   1/1     1m
</span></span></code></pre></div><h2 id="configcheck">ConfigCheck</h2><p>The Logging operator has a builtin mechanism that validates the generated syslog-ng configuration before applying it to syslog-ng. You should be able to see the configcheck pod and its log output. The result of the check is written into the <code>status</code> field of the corresponding <code>Logging</code> resource.</p><p>In case the operator is stuck in an error state caused by a failed configcheck, restore the previous configuration by modifying or removing the invalid resources to the point where the configcheck pod is finally able to complete successfully.</p><h2 id="check-syslog-ng-configuration">Check syslog-ng configuration</h2><p>Use the following command to display the configuration of syslog-ng:
<code>kubectl get secret logging-demo-syslogng-app -o jsonpath="{.data['syslog-ng\.conf']}" | base64 --decode</code></p><h2 id="getting-support">Getting Support</h2><p>If you encounter any problems that the documentation does not address, <a href="https://github.com/kube-logging/logging-operator/issues">file an issue</a> or talk to us on <a href="https://discord.gg/9ACY4RDsYN">Discord</a> or on the <a href="/4.10/docs/community/">CNCF Slack</a>.</p><p>Before asking for help, prepare the following information to make troubleshooting faster:</p><ul>
<li>Logging operator version</li><li>kubernetes version</li><li>helm/chart version (if you installed the Logging operator with helm)</li><li>Logging operator logs</li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#check-fluentd-configuration">fluentd configuration</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#get-fluentd-logs">fluentd logs</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentbit/#check-the-fluent-bit-configuration">fluentbit configuration</a></li><li>fluentbit logs</li></ul><p>Do not forget to remove any sensitive information (for example, passwords and private keys) before sharing.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-ff4769d67e22b03ee37bf3b31cd60c80">1.4 - Running on KinD</h1><p>Persistent Volumes do not respect the <code>fsGroup</code> value on Kind so disable using a PVC for fluentd:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-on-kind</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">disablePvc</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="getting-support">Getting Support</h2><p>If you encounter any problems that the documentation does not address, <a href="https://github.com/kube-logging/logging-operator/issues">file an issue</a> or talk to us on <a href="https://discord.gg/9ACY4RDsYN">Discord</a> or on the <a href="/4.10/docs/community/">CNCF Slack</a>.</p><p>Before asking for help, prepare the following information to make troubleshooting faster:</p><ul>
<li>Logging operator version</li><li>kubernetes version</li><li>helm/chart version (if you installed the Logging operator with helm)</li><li>Logging operator logs</li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#check-fluentd-configuration">fluentd configuration</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentd/#get-fluentd-logs">fluentd logs</a></li><li><a href="/4.10/docs/operation/troubleshooting/fluentbit/#check-the-fluent-bit-configuration">fluentbit configuration</a></li><li>fluentbit logs</li></ul><p>Do not forget to remove any sensitive information (for example, passwords and private keys) before sharing.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-f43e816fa3bb01ec74b11406f7aa77ce">2 - Monitor your logging pipeline with Prometheus Operator</h1><p align="center"><img src="../../img/lo-pro.png" alt="Logos" width="340"></p><p align="center"><img src="../../img/monitor.png" alt="Architecture" width="900"></p><p>You can configure the Logging operator to expose metrics endpoints for Fluentd, Fluent Bit, and syslog-ng using ServiceMonitor resources. That way, a Prometheus operator running in the same cluster can automatically fetch your logging metrics.</p><h2 id="metrics-variables">Metrics Variables</h2><p>You can configure the following metrics-related options in the <strong>spec.fluentd.metrics</strong>, <strong>spec.syslogNG.metrics</strong>, and <strong>spec.fluentbit.metrics</strong> sections of your Logging resource.</p><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>interval</td><td>string</td><td>No</td><td>&ldquo;15s&rdquo;</td><td>Scrape Interval</td></tr><tr>
<td>timeout</td><td>string</td><td>No</td><td>&ldquo;5s&rdquo;</td><td>Scrape Timeout</td></tr><tr>
<td>port</td><td>int</td><td>No</td><td>-</td><td>Metrics Port.</td></tr><tr>
<td>path</td><td>int</td><td>No</td><td>-</td><td>Metrics Path.</td></tr><tr>
<td>serviceMonitor</td><td>bool</td><td>No</td><td>false</td><td>Enable to create ServiceMonitor for Prometheus operator</td></tr><tr>
<td>prometheusAnnotations</td><td>bool</td><td>No</td><td>false</td><td>Add prometheus labels to fluent pods.</td></tr></tbody></table><p>For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">serviceMonitor</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentbit</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">serviceMonitor</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">syslogNG</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">serviceMonitor</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>For more details on installing the Prometheus operator and configuring and accessing metrics, see the following procedures.</p><h2 id="install-prometheus-operator-with-helm">Install Prometheus Operator with Helm</h2><ol>
<li>
<p>Create <code>logging</code> namespace</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create namespace logging
</span></span></code></pre></div></li><li>
<p>Install Prometheus Operator</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span> helm upgrade --install --wait --create-namespace --namespace logging monitor prometheus-community/kube-prometheus-stack <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboardProviders.dashboardproviders\\.yaml.apiVersion=1&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboardProviders.dashboardproviders\\.yaml.providers[0].orgId=1&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboardProviders.dashboardproviders\\.yaml.providers[0].type=file&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboardProviders.dashboardproviders\\.yaml.providers[0].disableDeletion=false&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboardProviders.dashboardproviders\\.yaml.providers[0].options.path=/var/lib/grafana/dashboards/default&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboards.default.logging.gnetId=7752&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboards.default.logging.revision=5&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;grafana.dashboards.default.logging.datasource=Prometheus&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06"></span>    --set <span style="color:#4e9a06">&#34;prometheus.prometheusSpec.serviceMonitorSelectorNilUsesHelmValues=False&#34;</span>
</span></span></code></pre></div><blockquote>
<p><a href="https://github.com/coreos/prometheus-operator">Prometheus Operator Documentation</a>
The prometheus-operator install may take a few more minutes. <em><strong>Please be patient.</strong></em>
The logging-operator metrics function depends on the prometheus-operator&rsquo;s resources.
If those do not exist in the cluster it may cause the logging-operator&rsquo;s malfunction.</p></blockquote></li></ol><h2 id="install-logging-operator-with-helm">Install Logging Operator with Helm</h2><ol>
<li>
<p>Install the Logging operator into the <em>logging</em> namespace:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging logging-operator oci://ghcr.io/kube-logging/helm-charts/logging-operator
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;logging-operator&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>Pulled: ghcr.io/kube-logging/helm-charts/logging-operator:4.3.0
</span></span><span style="display:flex"><span>Digest: sha256:c2ece861f66a3a2cb9788e7ca39a267898bb5629dc98429daa8f88d7acf76840
</span></span><span style="display:flex"><span>NAME: logging-operator
</span></span><span style="display:flex"><span>LAST DEPLOYED: Wed Aug  <span style="color:#0000cf;font-weight:700">9</span> 11:02:12 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: logging
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div><blockquote>
<p>Note:</p><ul>
<li>
<p>Helm has a known issue in version 3.13.0 that requires users to log in to the registry, even though the repo is public.</p><p>Upgrade to 3.13.1 or higher to avoid having to log in, see: <a href="https://github.com/kube-logging/logging-operator/issues/1522">https://github.com/kube-logging/logging-operator/issues/1522</a></p></li><li>
<p>If you&rsquo;re installing the Helm chart from Terraform, reference the repository as <code>repository = "oci://ghcr.io/kube-logging/helm-charts/"</code> (without the <code>logging-operator</code> suffix). Otherwise, you&rsquo;ll get a <a href="https://github.com/hashicorp/terraform-provider-helm/issues/1291">403 Forbidden error</a>.</p></li></ul></blockquote></li></ol><h2 id="install-minio">Install Minio</h2><ol>
<li>
<p>Create Minio Credential Secret</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging create secret generic logging-s3 --from-literal<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">accesskey</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#39;AKIAIOSFODNN7EXAMPLE&#39;</span> --from-literal<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">secretkey</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#39;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&#39;</span>
</span></span></code></pre></div></li><li>
<p>Deploy Minio</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: apps/v1
</span></span><span style="display:flex"><span>kind: Deployment
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: minio-deployment
</span></span><span style="display:flex"><span>  namespace: logging
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  selector:
</span></span><span style="display:flex"><span>    matchLabels:
</span></span><span style="display:flex"><span>      app: minio
</span></span><span style="display:flex"><span>  strategy:
</span></span><span style="display:flex"><span>    type: Recreate
</span></span><span style="display:flex"><span>  template:
</span></span><span style="display:flex"><span>    metadata:
</span></span><span style="display:flex"><span>      labels:
</span></span><span style="display:flex"><span>        app: minio
</span></span><span style="display:flex"><span>    spec:
</span></span><span style="display:flex"><span>      containers:
</span></span><span style="display:flex"><span>      - name: minio
</span></span><span style="display:flex"><span>        image: minio/minio
</span></span><span style="display:flex"><span>        args:
</span></span><span style="display:flex"><span>        - server
</span></span><span style="display:flex"><span>        - /data
</span></span><span style="display:flex"><span>        - <span style="color:#4e9a06">&#34;--console-address=:9001&#34;</span>
</span></span><span style="display:flex"><span>        readinessProbe:
</span></span><span style="display:flex"><span>          httpGet:
</span></span><span style="display:flex"><span>            path: /minio/health/ready
</span></span><span style="display:flex"><span>            port: <span style="color:#0000cf;font-weight:700">9000</span>
</span></span><span style="display:flex"><span>          initialDelaySeconds: <span style="color:#0000cf;font-weight:700">10</span>
</span></span><span style="display:flex"><span>          periodSeconds: <span style="color:#0000cf;font-weight:700">5</span>
</span></span><span style="display:flex"><span>        env:
</span></span><span style="display:flex"><span>        - name: MINIO_REGION
</span></span><span style="display:flex"><span>          value: <span style="color:#4e9a06">&#39;test_region&#39;</span>
</span></span><span style="display:flex"><span>        - name: MINIO_ROOT_USER
</span></span><span style="display:flex"><span>          valueFrom:
</span></span><span style="display:flex"><span>            secretKeyRef:
</span></span><span style="display:flex"><span>              name: logging-s3
</span></span><span style="display:flex"><span>              key: accesskey
</span></span><span style="display:flex"><span>        - name: MINIO_ROOT_PASSWORD
</span></span><span style="display:flex"><span>          valueFrom:
</span></span><span style="display:flex"><span>            secretKeyRef:
</span></span><span style="display:flex"><span>              name: logging-s3
</span></span><span style="display:flex"><span>              key: secretkey
</span></span><span style="display:flex"><span>        - name: MINIO_BROWSER_LOGIN_ANIMATION
</span></span><span style="display:flex"><span>          value: <span style="color:#4e9a06">&#34;off&#34;</span>
</span></span><span style="display:flex"><span>        ports:
</span></span><span style="display:flex"><span>        - containerPort: <span style="color:#0000cf;font-weight:700">9000</span>
</span></span><span style="display:flex"><span>        - containerPort: <span style="color:#0000cf;font-weight:700">9001</span>
</span></span><span style="display:flex"><span>      volumes:
</span></span><span style="display:flex"><span>        - name: logging-s3
</span></span><span style="display:flex"><span>          secret:
</span></span><span style="display:flex"><span>            secretName: logging-s3
</span></span><span style="display:flex"><span>---
</span></span><span style="display:flex"><span>kind: Service
</span></span><span style="display:flex"><span>apiVersion: v1
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: nginx-demo-minio
</span></span><span style="display:flex"><span>  namespace: logging
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  selector:
</span></span><span style="display:flex"><span>    app: minio
</span></span><span style="display:flex"><span>  ports:
</span></span><span style="display:flex"><span>  - name: http
</span></span><span style="display:flex"><span>    protocol: TCP
</span></span><span style="display:flex"><span>    port: <span style="color:#0000cf;font-weight:700">9000</span>
</span></span><span style="display:flex"><span>    targetPort: <span style="color:#0000cf;font-weight:700">9000</span>
</span></span><span style="display:flex"><span>  - name: console
</span></span><span style="display:flex"><span>    protocol: TCP
</span></span><span style="display:flex"><span>    port: <span style="color:#0000cf;font-weight:700">9001</span>
</span></span><span style="display:flex"><span>    targetPort: <span style="color:#0000cf;font-weight:700">9001</span>
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Create <code>logging</code> resource</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Logging
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: default-logging-simple
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  fluentd:
</span></span><span style="display:flex"><span>    metrics:
</span></span><span style="display:flex"><span>      serviceMonitor: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>  fluentbit:
</span></span><span style="display:flex"><span>    metrics:
</span></span><span style="display:flex"><span>      serviceMonitor: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>  controlNamespace: logging
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: <code>ClusterOutput</code> and <code>ClusterFlow</code> resource will only be accepted in the <code>controlNamespace</code></p></blockquote></li><li>
<p>Create Minio output definition</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Output
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: demo-output
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  s3:
</span></span><span style="display:flex"><span>    aws_key_id:
</span></span><span style="display:flex"><span>      valueFrom:
</span></span><span style="display:flex"><span>        secretKeyRef:
</span></span><span style="display:flex"><span>          key: accesskey
</span></span><span style="display:flex"><span>          name: logging-s3
</span></span><span style="display:flex"><span>    aws_sec_key:
</span></span><span style="display:flex"><span>      valueFrom:
</span></span><span style="display:flex"><span>        secretKeyRef:
</span></span><span style="display:flex"><span>          key: secretkey
</span></span><span style="display:flex"><span>          name: logging-s3
</span></span><span style="display:flex"><span>    buffer:
</span></span><span style="display:flex"><span>      timekey: 10s
</span></span><span style="display:flex"><span>      timekey_use_utc: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>      timekey_wait: 0s
</span></span><span style="display:flex"><span>    force_path_style: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex"><span>    path: logs/<span style="color:#4e9a06">${</span><span style="color:#000">tag</span><span style="color:#4e9a06">}</span>/%Y/%m/%d/
</span></span><span style="display:flex"><span>    s3_bucket: demo
</span></span><span style="display:flex"><span>    s3_endpoint: http://nginx-demo-minio.logging.svc.cluster.local:9000
</span></span><span style="display:flex"><span>    s3_region: test_region
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: For production set-up we recommend using longer <code>timekey</code> interval to avoid generating too many object.</p></blockquote></li><li>
<p>Create <code>flow</code> resource</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Flow
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: demo-flow
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  filters:
</span></span><span style="display:flex"><span>    - tag_normaliser: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>    - parser:
</span></span><span style="display:flex"><span>        remove_key_name_field: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>        reserve_data: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>        parse:
</span></span><span style="display:flex"><span>          type: nginx
</span></span><span style="display:flex"><span>  match:
</span></span><span style="display:flex"><span>    - <span style="color:#204a87;font-weight:700">select</span>:
</span></span><span style="display:flex"><span>        labels:
</span></span><span style="display:flex"><span>          app.kubernetes.io/instance: log-generator
</span></span><span style="display:flex"><span>          app.kubernetes.io/name: log-generator
</span></span><span style="display:flex"><span>  localOutputRefs:
</span></span><span style="display:flex"><span>    - demo-output
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Install log-generator to produce logs with the label <code>app.kubernetes.io/name: log-generator</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging log-generator oci://ghcr.io/kube-logging/helm-charts/log-generator
</span></span></code></pre></div></li></ol><h2 id="validation">Validation</h2><h3 id="minio">Minio</h3><ol>
<li>
<p>Get Minio login credentials</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging get secrets logging-s3 -o json <span style="color:#000;font-weight:700">|</span> jq <span style="color:#4e9a06">&#39;.data | map_values(@base64d)&#39;</span>
</span></span></code></pre></div></li><li>
<p>Forward Service</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging port-forward svc/nginx-demo-minio 9001:9001
</span></span></code></pre></div></li><li>
<p>Open the <a href="http://localhost:9001">Minio Dashboard: http://localhost:9001</a></p><p align="center"><img src="../../img/servicemonitor_minio.png" alt="Minio dashboard"></p></li></ol><h3 id="prometheus">Prometheus</h3><ol>
<li>
<p>Forward Service</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging port-forward svc/monitor-kube-prometheus-st-prometheus <span style="color:#0000cf;font-weight:700">9090</span>
</span></span></code></pre></div></li><li>
<p>Open the <a href="http://localhost:9090">Prometheus Dashboard: http://localhost:9090</a></p><p align="center"><img src="../../img/servicemonitor_prometheus.png" alt="Prometheus dashboard"></p></li></ol><h3 id="grafana">Grafana</h3><ol>
<li>
<p>Get Grafana login credentials</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get secret --namespace logging monitor-grafana -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#34;{.data.admin-password}&#34;</span> <span style="color:#000;font-weight:700">|</span> base64 --decode <span style="color:#000;font-weight:700">;</span> <span style="color:#204a87">echo</span>
</span></span></code></pre></div><blockquote>
<p>Default username: <code>admin</code></p></blockquote></li><li>
<p>Forward Service</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging port-forward svc/monitor-grafana 3000:80
</span></span></code></pre></div></li><li>
<p>Open <a href="http://localhost:3000">Grafana Dashboard: http://localhost:3000</a></p><p align="center"><img src="../../img/servicemonitor_grafana.png" alt="Grafana dashboard"></p></li></ol></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-362f849752620b4cf0d070e2fc884699">3 - Alerting</h1><p>This section describes how to set alerts for your logging infrastructure. Alternatively, you can enable the default alerting rules that are provided by the Logging operator.</p><blockquote>
<p>Note: Alerting based on the contents of the collected log messages is not covered here.</p></blockquote><h2 id="prerequisites">Prerequisites</h2><p>Using alerting rules requires the following:</p><ul>
<li>Logging operator 3.14.0 or newer installed on the cluster.</li><li>Prometheus operator installed on the cluster. For details, see <a href="/4.10/docs/operation/logging-operator-monitoring/">Monitor your logging pipeline with Prometheus Operator</a>.</li><li>
<p>syslog-ng is supported only in Logging operator 4.0 or newer.</p></li></ul><h2 id="enable-default-alerts">Enable the default alerting rules</h2><p>Logging operator comes with a number of default alerting rules that help you monitor your logging environment and ensure that it&rsquo;s working properly. To enable the default rules, complete the following steps.</p><ol>
<li>
<p>Verify that your cluster meets the <a href="#prerequisites">Prerequisites</a>.</p></li><li>
<p>Enable the alerting rules in your <strong>logging</strong> CR. You can enable alerting separately for Fluentd, syslog-ng, and Fluent Bit. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default-logging-simple</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">prometheusRules</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentbit</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">prometheusRules</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">syslogNG</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">metrics</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">prometheusRules</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">controlNamespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>If needed you can <a href="#custom-alerting-rules">add custom alerting rules</a>.</p></li></ol><h2 id="overview-of-default-alerting-rules">Overview of default alerting rules</h2><p>The default alerting rules trigger alerts when:</p><p>For the <strong>Fluent Bit</strong> log collector:</p><ul>
<li>The number of Fluent Bit errors or retries is high</li></ul><p>For the <strong>Fluentd</strong> and <strong>syslog-ng</strong> log forwarders:</p><ul>
<li>Prometheus cannot access the log forwarder node</li><li>The buffers of the log forwarder are filling up quickly</li><li>Traffic to the log forwarder is increasing at a high rate</li><li>The number of errors or retries is high on the log forwarder</li><li>The buffers are over 90% full</li></ul><p>Currently, you cannot modify the default alerting rules, because they are generated from the source files. For the detailed list of alerts, see the source code:</p><ul>
<li>For <a href="https://github.com/kube-logging/logging-operator/blob/master/pkg/resources/fluentd/prometheusrules.go">Fluentd</a></li><li>For <a href="https://github.com/kube-logging/logging-operator/blob/master/pkg/resources/syslogng/prometheusrules.go">syslog-ng</a></li><li>For <a href="https://github.com/kube-logging/logging-operator/blob/master/pkg/resources/fluentbit/prometheusrules.go">Fluent Bit</a></li></ul><p>To enable these alerts on your cluster, see <a href="#enable-default-alerts">Enable the default alerting rules</a>.</p><h2 id="custom-alerting-rules">Add custom alerting rules</h2><p>Although you cannot modify the default alerting rules, you can add your own custom rules to the cluster by creating and applying <a href="https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/alerting.md">AlertmanagerConfig resources to the Prometheus Operator</a>.</p><p>For example, the Logging operator creates the following alerting rule to detect if a Fluentd node is down:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">monitoring.coreos.com/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PrometheusRule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging-demo-fluentd-metrics</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">groups</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fluentd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">rules</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">alert</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FluentdNodeDown</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">description</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Prometheus could not scrape {{ &#34;{{ $labels.job }}&#34; }} for more</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#000">than 30 minutes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">summary</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fluentd cannot be scraped</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">expr</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">up{job=&#34;logging-demo-fluentd-metrics&#34;, namespace=&#34;logging&#34;} == 0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">for</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">10m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">labels</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">service</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fluentd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">severity</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">critical</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>On the Prometheus web interface, this rule looks like:</p><p><img src="alerting-rule-in-prometheus.png" alt="Fluentd alerting rule on the Prometheus web interface"></p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-e1b978ea58e795d55d2b6d7ad7aabb23">4 - Readiness probe</h1><p>This section describes how to configure readiness probes for your Fluentd and syslog-ng pods. If you don&rsquo;t configure custom readiness probes, Logging operator uses the default probes.</p><h2 id="prerequisites">Prerequisites</h2><ul>
<li>Configuring readiness probes requires Logging operator 3.14.0 or newer installed on the cluster.</li><li>
<p>syslog-ng is supported only in Logging operator 4.0 or newer.</p></li></ul><h2 id="overview-of-default-readiness-probes">Overview of default readiness probes</h2><p>By default, Logging operator performs the following readiness checks:</p><ul>
<li>Number of buffer files is too high (higher than 5000)</li><li>Fluentd buffers are over 90% full</li><li>syslog-ng buffers are over 90% full</li></ul><p>The parameters of the readiness probes and pod failure is set by using the usual <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">Kubernetes probe configuration parameters</a>. Instead of the Kubernetes defaults, the Logging operator uses the following values for these parameters:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">InitialDelaySeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">TimeoutSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">PeriodSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">SuccessThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">FailureThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Currently, you cannot modify the default readiness probes, because they are generated from the source files. For the detailed list of readiness probes, see the <a href="#default-readiness-probes">Default readiness probes</a>. However, you can customize their values in the Logging custom resource, separately for the Fluentd and syslog-ng log forwarder. For example:</p><h3 id="fluentd-readiness-probe-settings">Fluentd readiness probe settings</h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging-demo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">controlNamespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">readinessDefaultCheck</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFileNumber</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFileNumberMax</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFreeSpace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFreeSpaceThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">90</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">failureThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">initialDelaySeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">periodSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">successThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">timeoutSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="syslogng-readiness-probe-settings">SyslogNG readiness probe settings</h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging-demo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">controlNamespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">syslogNG</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">readinessDefaultCheck</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFileNumber</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFileNumberMax</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFreeSpace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">bufferFreeSpaceThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">90</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">failureThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">initialDelaySeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">periodSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">successThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">timeoutSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="default-readiness-probes">Default readiness probes</h2><p>The Logging operator applies the following readiness probe by default:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">readinessProbe</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">exec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">/bin/sh</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- -<span style="color:#000">c</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">FREESPACE_THRESHOLD=90</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">FREESPACE_CURRENT=$(df -h $BUFFER_PATH  | grep / | awk &#39;{ print $5}&#39; | sed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#4e9a06">&#39;s/%//g&#39;</span><span style="color:#000">)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">if [ &#34;$FREESPACE_CURRENT&#34; -gt &#34;$FREESPACE_THRESHOLD&#34; ] ; then exit 1; fi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">MAX_FILE_NUMBER=5000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">FILE_NUMBER_CURRENT=$(find $BUFFER_PATH -type f -name *.buffer | wc -l)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">if [ &#34;$FILE_NUMBER_CURRENT&#34; -gt &#34;$MAX_FILE_NUMBER&#34; ] ; then exit 1; fi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">failureThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">initialDelaySeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">periodSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">successThreshold</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">timeoutSeconds</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="custom-readiness-probes">Add custom readiness probes</h2><p>You can add your own custom readiness probes to the <strong>spec.ReadinessProbe</strong> section of the <strong>logging</strong> custom resource. For details on the format of readiness probes, see the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes">official Kubernetes documentation</a>.</p><div class="warning-block">
<p><strong>CAUTION:</strong></p>If you set any custom readiness probes, they completely override the default probes.
</div></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-791b523329c1485057fb827f9ed4b80b">5 - Collect Fluentd errors</h1><p>This section describes how to collect Fluentd error messages (messages that are sent to the <a href="https://docs.fluentd.org/configuration/config-file#error-label">@ERROR label</a> from another plugin in Fluentd).</p><blockquote>
<p>Note: It depends on the specific plugin implementation what messages are sent to the @ERROR label. For example, a parsing plugin that fails to parse a line could send that line to the @ERROR label.</p></blockquote><h2 id="prerequisites">Prerequisites</h2><p>Configuring readiness probes requires Logging operator 3.14.0 or newer installed on the cluster.</p><h2 id="configure-error-output">Configure error output</h2><p>To collect the error messages of Fluentd, complete the following steps.</p><ol>
<li>
<p>Create a ClusterOutput that receives logs from every logging flow where error happens. For example, create a file output. For details on creating outputs, see <a href="/4.10/docs/configuration/output/">Output and ClusterOutput</a>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterOutput</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">error-file</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">file</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/tmp/error.log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>Set the <code>errorOutputRef</code> in the Logging resource to your preferred ClusterOutput.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">controlNamespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">enableRecreateWorkloadOnImmutableFieldChange</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">errorOutputRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">error-file</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentbit</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">bufferStorage</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">bufferStorageVolume</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">hostPath</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">path</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">filterKubernetes</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># rest of the resource is omitted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You cannot apply filters for this specific error flow.</p></li><li>
<p>Apply the ClusterOutput and Logging to your cluster.</p></li></ol></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-5ac19d15e22096d860ccfc7422b529f9">6 - Optimization</h1><h2 id="watch-specific-resources">Watch specific resources</h2><p>The Logging operator watches resources in all namespaces, which is required because it manages cluster-scoped objects, and also objects in multiple namespaces.</p><p>However, in a large-scale infrastructure, where the number of resources is large, it makes sense to limit the scope of resources monitored by the Logging operator to save considerable amount of memory and container restarts.</p><p>Starting with Logging operator version 3.12.0, this is now available by passing the following command-line arguments to the operator.</p><ul>
<li><code>watch-namespace</code>: Watch only objects in this namespace. Note that even if the <code>watch-namespace</code> option is set, the operator must watch certain objects (like <code>Flows</code> and <code>Outputs</code>) in every namespace.</li><li><code>watch-logging-name</code>: Logging resource name to optionally filter the list of watched objects based on which logging they belong to by checking the <code>app.kubernetes.io/managed-by</code> label.</li></ul></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-af5ba8326f5b4c35d5dc6de4337c19b0">7 - Scaling</h1><blockquote>
<p>Note: When multiple instances send logs to the same output, the output can receive chunks of messages out of order. Some outputs tolerate this (for example, Elasticsearch), some do not, some require fine tuning (for example, Loki).</p></blockquote><h2 id="scaling-fluentd">Scaling Fluentd</h2><p>In a large-scale infrastructure the logging components can get high load as well. The typical sign of this is when <code>fluentd</code> cannot handle its <a href="../../configuration/plugins/outputs/buffer/">buffer</a> directory size growth for more than the configured or calculated (timekey + timekey_wait) flush interval. In this case, you can <a href="/4.10/docs/logging-infrastructure/fluentd/#scaling">scale the fluentd statefulset</a>.</p><p>The Logging Operator supports scaling a <strong>Fluentd aggregator</strong> statefulset up and down. Scaling statefulset pods down is challenging, because we need to take care of the underlying volumes with buffered data that hasn&rsquo;t been sent, but the Logging Operator supports that use case as well.</p><p>The details for that and how to configure an HPA is described in the following documents:</p><ul>
<li><a href="https://github.com/kube-logging/logging-operator/blob/master/docs/volume-drainer.md">https://github.com/kube-logging/logging-operator/blob/master/docs/volume-drainer.md</a></li><li><a href="https://github.com/kube-logging/logging-operator/blob/master/docs/scaling.md">https://github.com/kube-logging/logging-operator/blob/master/docs/scaling.md</a></li></ul><h2 id="scaling-syslogng">Scaling SyslogNG</h2><p>SyslogNG can be scaled up as well, but persistent disk buffers are not processed automatically when scaling the statefulset down. That is currently a manual process.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-2ea22a017fd9fef2575c36200cd7f9b8">8 - CPU and memory requirements</h1><p>The resource requirements and limits of your Logging operator deployment must match the size of your cluster and the logging workloads. By default, the Logging operator uses the following configuration.</p><ul>
<li>
<p>For <strong>Fluent Bit</strong>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span>- <span style="color:#204a87;font-weight:700">Limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">200m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">100M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:700">Requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">100m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">50M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>For <strong>Fluentd</strong> and <strong>syslog-ng</strong>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span>- <span style="color:#204a87;font-weight:700">Limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1000m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">400M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:700">Requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">100M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li></ul><p>You can adjust these values in the Logging custom resource, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging.banzaicloud.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default-logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">namespace</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">logging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentd</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">resources</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">2Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">fluentbit</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">resources</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">syslogNG</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">resources</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">requests</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500M</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">limits</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">cpu</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">memory</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/kube-logging/logging-operator" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="/docs/community/" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Discord" aria-label="Discord">
<a class="text-white" target="_blank" rel="noopener" href="https://discord.gg/9ACY4RDsYN" aria-label="Discord">
<i class="fab fa-discord"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white"><a class="text-white" href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> | </small>
<small class="text-white">&copy; 2025 kube-logging authors | All Rights Reserved</small>
</div></div></div></footer></div><script src="/4.10/js/main.min.8a95aa7e2d8d9eef50403c6b32e59ad14b7fbf74c438eef4b46bbb472b58dcc9.js" integrity="sha256-ipWqfi2Nnu9QQDxrMuWa0Ut/v3TEOO70tGu7RytY3Mk=" crossorigin="anonymous"></script>
<script src='/4.10/js/prism.js'></script>
<script src='/4.10/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
<script>(function(){var e=document.querySelector("#td-section-nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</body></html>