<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="canonical" type="text/html" href="https://kube-logging.dev/docs/configuration/extensions/">
<link rel="alternate" type="text/releases" href="https://kube-logging.dev/docs/configuration/extensions/releases.releases">
<meta name="robots" content="noindex, nofollow">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">
<title>Kubernetes events, node logs, and logfiles | Logging operator</title><meta name="description" content="Documentation for the Logging operator">
<meta property="og:title" content="Kubernetes events, node logs, and logfiles">
<meta property="og:description" content="Documentation for the Logging operator">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kube-logging.dev/docs/configuration/extensions/"><meta property="og:site_name" content="Logging operator">
<meta itemprop="name" content="Kubernetes events, node logs, and logfiles">
<meta itemprop="description" content="Documentation for the Logging operator"><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubernetes events, node logs, and logfiles">
<meta name="twitter:description" content="Documentation for the Logging operator">
<meta name="twitter:site" content="@calisti12">
<link rel="preload" href="/scss/main.min.ea124d1a5ca55adb367f0f334ac1055fd60c2385e8ffc34d5f01caac50a69f6c.css" as="style">
<link href="/scss/main.min.ea124d1a5ca55adb367f0f334ac1055fd60c2385e8ffc34d5f01caac50a69f6c.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/lunr@2.3.9/lunr.min.js" integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
<link rel="canonical" href="https://kube-logging.dev/docs/configuration/extensions/">
</head><body class="td-section">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 3237.738 490.023" id="svg142" sodipodi:docname="logo-new2.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs146"/><sodipodi:namedview id="namedview144" pagecolor="#505050" bordercolor="#ffffff" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#505050" showgrid="false" inkscape:zoom=".37340884" inkscape:cx="1620.208" inkscape:cy="243.70071" inkscape:window-width="705" inkscape:window-height="480" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="svg142"/><g id="Group_2068" data-name="Group 2068" transform="translate(-43577.297 -34456.625)"><g id="Group_2067" data-name="Group 2067" transform="translate(27723.789 24565.273)"><path id="Path_4217" data-name="Path 4217" d="M47842.219 34024.414l-276.027 475.07h71.242l240.227-414.1z" transform="translate(-31703.996 -24123.111)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4218" data-name="Path 4218" d="M47831.324 34080.781l166.754 287.355h-333.035z" transform="translate(-31640.254 -24086.76)" fill="#fff" stroke="#fff" stroke-width="10"/><path id="Path_4220" data-name="Path 4220" d="M47668.742 34274.2l-37.727 64.1h442.43l-37.156-64.1z" transform="translate(-31662.199 -23962.018)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4222" data-name="Path 4222" d="M11294.989 10157.944l311.97-.01-156.218-269.074-78.621 135.83z" transform="translate(4740.338 117.39)" fill="#fff"/><path id="Path_4224" data-name="Path 4224" d="M47787.594 34159.125l-54.391 93.035h108.039z" transform="translate(-31596.297 -24036.238)" fill="#13142c" stroke="#13132d" stroke-width="10"/></g><text id="Logging_Operator" data-name="Logging Operator" transform="translate(45475.035 34799.609)" fill="#fff" font-size="267" font-family="Montserrat-Bold, Montserrat" font-weight="700" letter-spacing=".046em"><tspan x="-1339.806" y="0" id="tspan138">Logging Operator</tspan></text></g></svg></span><span class="navbar-brand__name">Logging operator</span>
<span class="font-weight-bold navbar-logo navbar-version">4.2.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/kube-logging/logging-operator" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/docs/"><span>Documentation</span></a>
</li><li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
<div w3-include-html="/docs/configuration/extensions//releases.releases" w3-include-html-default='<a class="dropdown-item" href="/docs/releases.releases">Latest</a>'></div><script type="application/x-javascript">w3.includeHTML()</script>
</div></li></ul></div><div class="navbar-nav d-none d-lg-block">
<div class="td-search td-search--offline">
<div class="td-search__icon"></div><input type="search" class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete="off" data-offline-search-index-json-src="/offline-search-index.a65605e79e0502ce9193682f88cce494.json" data-offline-search-base-href="/" data-offline-search-max-results="10">
</div></div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href="/docs/configuration/extensions/">Return to the regular view of this page</a>.
</p></div><h1 class="title">Kubernetes events, node logs, and logfiles</h1><ul>
<li>1: <a href="#pg-04413fd144b07886f11cf231a5113cbc">Kubernetes Event Tailer</a></li><li>2: <a href="#pg-18c73f8f2b09bffa26f060f563c9b14a">Kubernetes host logs, journals, and logfiles</a></li><li>3: <a href="#pg-064cf3669ed75479a61d9edba52b81d4">Tail logfiles with a webhook</a></li></ul><div class="content">
<p>The Logging extensions part of the Logging operator solves the following problems:</p><ul>
<li>Collect Kubernetes events to provide insight into what is happening inside a cluster, such as decisions made by the scheduler, or why some pods were evicted from the node.</li><li>Collect logs from the nodes like <code>kubelet</code> logs.</li><li>Collect logs from files on the nodes, for example, <code>audit</code> logs, or the <code>systemd</code> journal.</li><li>Collect logs from legacy application log files.</li></ul><p>Starting with Logging operator version 3.17.0, logging-extensions are open source and part of Logging operator.</p><h2 id="features">Features</h2><p>Logging-operator handles the new features the well-known way: it uses custom resources to access the features. This way a simple <code>kubectl apply</code> with a particular parameter set initiates a new feature. Extensions supports three different custom resource types:</p><ul>
<li>
<p>Logging-operator handles the new features the well-known way: it uses custom resources to access the features. This way a simple <code>kubectl apply</code> with a particular parameter set initiates a new feature. Extensions supports three different custom resource types:</p></li><li>
<p><a href="/docs/configuration/extensions/kubernetes-event-tailer/">Event-tailer</a> listens for Kubernetes events and transmits their changes to stdout, so the Logging operator can process them.</p></li><li>
<p><a href="/docs/configuration/extensions/kubernetes-host-tailer/">Host-tailer</a> tails custom files and transmits their changes to stdout. This way the Logging operator can process them.
Kubernetes host tailer allows you to tail logs like <code>kubelet</code>, <code>audit</code> logs, or the <code>systemd</code> journal from the nodes.</p></li><li>
<p><a href="/docs/configuration/extensions/tailer-webhook/">Tailer-webhook</a> is a different approach for the same problem: parsing legacy application&rsquo;s log file. Instead of running a <code>host-tailer</code> instance on every node, <code>tailer-webhook</code> attaches a <code>sidecar container</code> to the pod, and reads the specified file(s).</p></li></ul><blockquote>
<p>Check our <a href="https://github.com/kube-logging/logging-operator/tree/master/config/samples/extensions">configuration snippets</a> for examples.</p></blockquote></div></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-04413fd144b07886f11cf231a5113cbc">1 - Kubernetes Event Tailer</h1><p>Kubernetes events are objects that provide insight into what is happening inside a cluster, such as what decisions were made by the scheduler or why some pods were evicted from the node. Event tailer listens for Kubernetes events and transmits their changes to stdout, so the Logging operator can process them.</p><p><img src="../logging-extensions-event-tailer.png" alt="Event tailer"></p><p>The operator handles this CR and generates the following required resources:</p><ul>
<li>ServiceAccount: new account for <code>event-tailer</code></li><li>ClusterRole: sets the <code>event-tailer's</code> roles</li><li>ClusterRoleBinding: links the account with the roles</li><li>ConfigMap: contains the configuration for the <code>event-tailer</code> pod</li><li>StatefulSet: manages the lifecycle of the <code>event-tailer</code> pod, which uses the <code>banzaicloud/eventrouter:v0.1.0</code> image to tail events</li></ul><h2 id="create-event-tailer">Create event tailer</h2><ol>
<li>
<p>The simplest way to init an <code>event-tailer</code> is to create a new <code>event-tailer</code> resource with a <code>name</code> and <code>controlNamespace</code> field specified. The following command creates an event tailer called <code>sample</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: EventTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  controlNamespace: default
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div></li><li>
<p>Check that the new object has been created by running:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get eventtailer
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME     AGE
</span></span><span style="display:flex"><span>sample   22m
</span></span></code></pre></div></li><li>
<p>You can see the events in JSON format by checking the log of the <code>event-tailer</code> pod. This way Logging operator can collect the events, and handle them as any other log. Run:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs -l app.kubernetes.io/instance<span style="color:#ce5c00;font-weight:700">=</span>sample-event-tailer <span style="color:#000;font-weight:700">|</span> head -1 <span style="color:#000;font-weight:700">|</span> jq
</span></span></code></pre></div><p>The output should be similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">&#34;verb&#34;</span>: <span style="color:#4e9a06">&#34;UPDATED&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">&#34;event&#34;</span>: <span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;metadata&#34;</span>: <span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#4e9a06">&#34;kube-scheduler-kind-control-plane.17145dad77f0e528&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;namespace&#34;</span>: <span style="color:#4e9a06">&#34;kube-system&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;uid&#34;</span>: <span style="color:#4e9a06">&#34;c2416fa6-7b7f-4a7d-a5f1-b2f2241bd599&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;resourceVersion&#34;</span>: <span style="color:#4e9a06">&#34;424&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;creationTimestamp&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-13T08:19:22Z&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;managedFields&#34;</span>: <span style="color:#ce5c00;font-weight:700">[</span>
</span></span><span style="display:flex"><span>        <span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>          <span style="color:#4e9a06">&#34;manager&#34;</span>: <span style="color:#4e9a06">&#34;kube-controller-manager&#34;</span>,
</span></span><span style="display:flex"><span>          <span style="color:#4e9a06">&#34;operation&#34;</span>: <span style="color:#4e9a06">&#34;Update&#34;</span>,
</span></span><span style="display:flex"><span>          <span style="color:#4e9a06">&#34;apiVersion&#34;</span>: <span style="color:#4e9a06">&#34;v1&#34;</span>,
</span></span><span style="display:flex"><span>          <span style="color:#4e9a06">&#34;time&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-13T08:19:22Z&#34;</span>
</span></span><span style="display:flex"><span>        <span style="color:#ce5c00;font-weight:700">}</span>
</span></span><span style="display:flex"><span>      <span style="color:#ce5c00;font-weight:700">]</span>
</span></span><span style="display:flex"><span>    <span style="color:#ce5c00;font-weight:700">}</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;involvedObject&#34;</span>: <span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;kind&#34;</span>: <span style="color:#4e9a06">&#34;Pod&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;namespace&#34;</span>: <span style="color:#4e9a06">&#34;kube-system&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#4e9a06">&#34;kube-scheduler-kind-control-plane&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;uid&#34;</span>: <span style="color:#4e9a06">&#34;7bd2c626-84f2-49c3-8e8e-8a7c0514b686&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;apiVersion&#34;</span>: <span style="color:#4e9a06">&#34;v1&#34;</span>,
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;resourceVersion&#34;</span>: <span style="color:#4e9a06">&#34;322&#34;</span>
</span></span><span style="display:flex"><span>    <span style="color:#ce5c00;font-weight:700">}</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;reason&#34;</span>: <span style="color:#4e9a06">&#34;NodeNotReady&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;message&#34;</span>: <span style="color:#4e9a06">&#34;Node is not ready&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;source&#34;</span>: <span style="color:#ce5c00;font-weight:700">{</span>
</span></span><span style="display:flex"><span>      <span style="color:#4e9a06">&#34;component&#34;</span>: <span style="color:#4e9a06">&#34;node-controller&#34;</span>
</span></span><span style="display:flex"><span>    <span style="color:#ce5c00;font-weight:700">}</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;firstTimestamp&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-13T08:19:22Z&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;lastTimestamp&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-13T08:19:22Z&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;count&#34;</span>: 1,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;Warning&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;eventTime&#34;</span>: null,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;reportingComponent&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
</span></span><span style="display:flex"><span>    <span style="color:#4e9a06">&#34;reportingInstance&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>
</span></span><span style="display:flex"><span>  <span style="color:#ce5c00;font-weight:700">}</span>,...
</span></span></code></pre></div></li><li>
<p>Once you have an <code>event-tailer</code>, you can bind your events to a specific logging flow. The following example configures a flow to route the previously created <code>sample-eventtailer</code> to the <code>sample-output</code>.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging.banzaicloud.io/v1beta1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: Flow
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: eventtailer-flow
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  namespace: default
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  filters:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - tag_normaliser: {}
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  match:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # keeps data matching to label, the rest of the data will be discarded by this flow implicitly
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - select:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      labels:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        app.kubernetes.io/name: sample-event-tailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  outputRefs:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - sample-output
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div></li></ol><h2 id="delete-event-tailer">Delete event tailer</h2><p>To remove an unwanted tailer, delete the related <code>event-tailer</code> custom resource. This terminates the <code>event-tailer</code> pod. For example, run the following command to delete the event tailer called <code>sample</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl delete eventtailer sample <span style="color:#ce5c00;font-weight:700">&amp;&amp;</span> kubectl get pod
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>eventtailer.logging-extensions.banzaicloud.io <span style="color:#4e9a06">&#34;sample&#34;</span> deleted
</span></span><span style="display:flex"><span>NAME                    READY   STATUS        RESTARTS   AGE
</span></span><span style="display:flex"><span>sample-event-tailer-0   1/1     Terminating   <span style="color:#0000cf;font-weight:700">0</span>          12s
</span></span></code></pre></div><h2 id="persist-event-logs">Persist event logs</h2><p>Event-tailer supports persist mode. In this case, the logs generated from events are stored on a persistent volume. Add the following configuration to your event-tailer spec. In this example, the event tailer is called <code>sample</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: EventTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  controlNamespace: default
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  positionVolume:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    pvc:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        accessModes:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">          - ReadWriteOnce
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        resources:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">          requests:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">            storage: 1Gi
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        volumeMode: Filesystem
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Logging operator manages the persistent volume of event-tailer automatically, you don&rsquo;t have any further task with it. To check that the persistent volume has been created, run:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pvc <span style="color:#ce5c00;font-weight:700">&amp;&amp;</span> kubectl get pv
</span></span></code></pre></div><p>The output should be similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span style="display:flex"><span>sample-event-tailer-sample-event-tailer-0   Bound    pvc-6af02cb2-3a62-4d24-8201-dc749034651e   1Gi        RWO            standard       43s
</span></span><span style="display:flex"><span>NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                               STORAGECLASS   REASON   AGE
</span></span><span style="display:flex"><span>pvc-6af02cb2-3a62-4d24-8201-dc749034651e   1Gi        RWO            Delete           Bound    default/sample-event-tailer-sample-event-tailer-0   standard                42s
</span></span></code></pre></div><h2 id="configuration-options">Configuration options</h2><p>For the detailed list of configuration options, see the <a href="/docs/configuration/crds/extensions/eventtailer_types/">EventTailer CRD reference</a>.</p></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-18c73f8f2b09bffa26f060f563c9b14a">2 - Kubernetes host logs, journals, and logfiles</h1><p>Kubernetes host tailer allows you to tail logs like <code>kubelet</code>, <code>audit</code> logs, or the <code>systemd</code> journal from the nodes.</p><p><img src="../logging-extensions-host-tailer.png" alt="Host-tailer"></p><h2 id="create-host-tailer">Create host tailer</h2><p>To tail logs from the node&rsquo;s host filesystem, define one or more file tailers in the <code>host-tailer</code> configuration.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: HostTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: multi-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # list of File tailers
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  fileTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-access
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/access.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-error
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/error.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # list of Systemd tailers
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  systemdTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: my-systemd-tailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      maxEntries: 100
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      systemdFilter: kubelet.service
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="create-file-tailer">Create file tailer</h2><p>When an application (mostly legacy programs) is not logging in a Kubernetes-native way, Logging operator cannot process its logs. (For example, an old application does not send its logs to <code>stdout</code>, but uses some log files instead.) <code>File-tailer</code> helps to solve this problem: It configures Fluent Bit to tail the given file(s), and sends the logs to the <code>stdout</code>, to implement Kubernetes-native logging.</p><p><img src="../logging-extensions-host-tailer2.png" alt="Host-tailer"></p><p>However, <code>file-tailer</code> cannot access the pod&rsquo;s local dir, so the logfiles need to be written on a mounted volume.</p><p>Let&rsquo;s assume the following code represents a legacy application that generates logs into the <code>/legacy-logs/date.log</code> file. While the legacy-logs directory is mounted, it&rsquo;s accessible from other pods by mounting the same volume.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: v1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: Pod
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: test-pod
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  containers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - image: busybox
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    name: test
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    volumeMounts:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - mountPath: /legacy-logs
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      name: test-volume
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    command: [&#34;/bin/sh&#34;, &#34;-c&#34;]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    args:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      - while true; do
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">          date &gt;&gt; /legacy-logs/date.log;
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">          sleep 1;
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        done
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  volumes:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - name: test-volume
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    hostPath:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /legacy-logs
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>To tail the logs of the previous example application, you can use the following <code>host-tailer</code> custom resource:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: HostTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: file-hosttailer-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  fileTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: sample-logfile
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /legacy-logs/date.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      disabled: false
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Logging operator configure the environment and start a <code>file-tailer</code> pod. It&rsquo;s also able to deal with multi-node clusters, since is starts the <code>host-tailer</code> pod through a <code>daemonset</code>.</p><p>Check the created file tailer pod:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod
</span></span></code></pre></div><p>The output should be similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex"><span>file-hosttailer-sample-host-tailer-5tqhv   1/1     Running   <span style="color:#0000cf;font-weight:700">0</span>          117s
</span></span><span style="display:flex"><span>test-pod                                   1/1     Running   <span style="color:#0000cf;font-weight:700">0</span>          5m40s
</span></span></code></pre></div><p>Checking the logs of the <code>file-tailer's</code> pod. You will see the logfile&rsquo;s content on <code>stdout</code>. This way Logging operator can process those logs as well.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs file-hosttailer-sample-host-tailer-5tqhv
</span></span></code></pre></div><p>The logs of the sample application should be similar to:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Fluent Bit v1.9.5
</span></span><span style="display:flex"><span>* Copyright <span style="color:#ce5c00;font-weight:700">(</span>C<span style="color:#ce5c00;font-weight:700">)</span> 2015-2022 The Fluent Bit Authors
</span></span><span style="display:flex"><span>* Fluent Bit is a CNCF sub-project under the umbrella of Fluentd
</span></span><span style="display:flex"><span>* https://fluentbit.io
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>fluent bit<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>1.9.5, <span style="color:#000">commit</span><span style="color:#ce5c00;font-weight:700">=</span>9ec43447b6, <span style="color:#000">pid</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>storage<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>1.2.0, <span style="color:#000">type</span><span style="color:#ce5c00;font-weight:700">=</span>memory-only, <span style="color:#000">sync</span><span style="color:#ce5c00;font-weight:700">=</span>normal, <span style="color:#000">checksum</span><span style="color:#ce5c00;font-weight:700">=</span>disabled, <span style="color:#000">max_chunks_up</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">128</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>cmetrics<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>0.3.4
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>sp<span style="color:#ce5c00;font-weight:700">]</span> stream processor started
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>output:file:file.0<span style="color:#ce5c00;font-weight:700">]</span> worker <span style="color:#8f5902;font-style:italic">#0 started</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/13 12:26:02<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>input:tail:tail.0<span style="color:#ce5c00;font-weight:700">]</span> inotify_fs_add<span style="color:#ce5c00;font-weight:700">()</span>: <span style="color:#000">inode</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">418051</span> <span style="color:#000">watch_fd</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">1</span> <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:700">=</span>/legacy-logs/date.log
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:51 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:52 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:53 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:54 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:55 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Tue Sep <span style="color:#0000cf;font-weight:700">13</span> 12:22:56 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span></code></pre></div><h3 id="file-tailer-configuration-options">File Tailer configuration options</h3><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>name</td><td>string</td><td>Yes</td><td>-</td><td>Name for the tailer<br></td></tr><tr>
<td>path</td><td>string</td><td>No</td><td>-</td><td>Path to the loggable file<br></td></tr><tr>
<td>disabled</td><td>bool</td><td>No</td><td>-</td><td>Disable tailing the file<br></td></tr><tr>
<td>containerOverrides</td><td>*types.ContainerBase</td><td>No</td><td>-</td><td>Override container fields for the given tailer<br></td></tr></tbody></table><h2 id="tail-systemd-journal">Tail systemd journal</h2><p>This is a special case of <code>file-tailer</code>, since it tails the <code>systemd</code> journal file specifically.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: HostTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: systemd-tailer-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # list of Systemd tailers
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  systemdTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: my-systemd-tailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      maxEntries: 100
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      systemdFilter: kubelet.service
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h3 id="systemd-tailer-configuration-options">Systemd tailer configuration options</h3><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>name</td><td>string</td><td>Yes</td><td>-</td><td>Name for the tailer<br></td></tr><tr>
<td>path</td><td>string</td><td>No</td><td>-</td><td>Override systemd log path<br></td></tr><tr>
<td>disabled</td><td>bool</td><td>No</td><td>-</td><td>Disable component<br></td></tr><tr>
<td>systemdFilter</td><td>string</td><td>No</td><td>-</td><td>Filter to select systemd unit example: kubelet.service<br></td></tr><tr>
<td>maxEntries</td><td>int</td><td>No</td><td>-</td><td>Maximum entries to read when starting to tail logs to avoid high pressure<br></td></tr><tr>
<td>containerOverrides</td><td>*types.ContainerBase</td><td>No</td><td>-</td><td>Override container fields for the given tailer<br></td></tr></tbody></table><h2 id="example-configure-logging-flow-to-route-logs-from-a-host-tailer">Example: Configure logging Flow to route logs from a host tailer</h2><p>The following example uses the flow&rsquo;s match term to listen the previously created <code>file-hosttailer-sample</code> Hosttailer&rsquo;s log.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging.banzaicloud.io/v1beta1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: Flow
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: hosttailer-flow
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  namespace: default
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  filters:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - tag_normaliser: {}
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # keeps data matching to label, the rest of the data will be discarded by this flow implicitly
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  match:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - select:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      labels: 
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        app.kubernetes.io/name: file-hosttailer-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      # there might be a need to match on container name too (in case of multiple containers)
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      container_names:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        - nginx-access
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  outputRefs:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - sample-output
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="example-kubernetes-host-tailer-with-multiple-tailers">Example: Kubernetes host tailer with multiple tailers</h2><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: HostTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: multi-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # list of File tailers
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  fileTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-access
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/access.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-error
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/error.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # list of Systemd tailers
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  systemdTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: my-systemd-tailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      maxEntries: 100
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      systemdFilter: kubelet.service
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="set-custom-priority">Set custom priority</h2><p>Create your own custom priority class in Kubernetes. Set its value between 0 and 2000000000. Note that:</p><ul>
<li>0 is the default priority</li><li>To change the default priority, set the <code>globalDefault</code> key.</li><li>2000000000 and above are reserved for the Kubernetes system</li><li>PriorityClass is a non-namespaced object.</li></ul><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: scheduling.k8s.io/v1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: PriorityClass
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: hosttailer-priority
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">value: 1000000
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">globalDefault: false
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">description: &#34;This priority class should be used for hosttailer pods only.&#34;
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Now you can use your private priority class name to start hosttailer/eventtailer, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f -<span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: logging-extensions.banzaicloud.io/v1alpha1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: HostTailer
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: priority-sample
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  controlNamespace: default
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  # Override podSpecBase variables here
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  workloadOverrides:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    priorityClassName: hosttailer-priority
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  fileTailers:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-access
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/access.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: nginx-error
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      path: /var/log/nginx/error.log
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="configuration-options">Configuration options</h2><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>fileTailers</td><td>[]FileTailer</td><td>No</td><td>-</td><td>List of file tailers<br></td></tr><tr>
<td>c</td><td>[]SystemdTailer</td><td>No</td><td>-</td><td>List of systemd tailers<br></td></tr><tr>
<td>enableRecreateWorkloadOnImmutableFieldChange</td><td>bool</td><td>No</td><td>-</td><td>EnableRecreateWorkloadOnImmutableFieldChange enables the operator to recreate the<br>fluentbit daemonset and the fluentd statefulset (and possibly other resource in the future)<br>in case there is a change in an immutable field<br>that otherwise couldn&rsquo;t be managed with a simple update.<br></td></tr><tr>
<td>workloadMetaOverrides</td><td>*types.MetaBase</td><td>No</td><td>-</td><td>Override metadata of the created resources<br></td></tr><tr>
<td>workloadOverrides</td><td>*types.PodSpecBase</td><td>No</td><td>-</td><td>Override podSpec fields for the given daemonset<br></td></tr></tbody></table><h2 id="advanced-configuration-overrides">Advanced configuration overrides</h2><h3 id="metabase">MetaBase</h3><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>annotations</td><td><code>map[string]string</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>labels</td><td><code>map[string]string</code></td><td>No</td><td>-</td><td></td></tr></tbody></table><h3 id="podspecbase">PodSpecBase</h3><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>tolerations</td><td><code>[]corev1.Toleration</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>nodeSelector</td><td><code>map[string]string</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>serviceAccountName</td><td><code>string</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>affinity</td><td><code>*corev1.Affinity</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>securityContext</td><td><code>*corev1.PodSecurityContext</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>volumes</td><td><code>[]corev1.Volume</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>priorityClassName</td><td><code>string</code></td><td>No</td><td>-</td><td></td></tr></tbody></table><h3 id="containerbase">ContainerBase</h3><table>
<thead>
<tr>
<th>Variable Name</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr>
<td>resources</td><td><code>*corev1.ResourceRequirements</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>image</td><td><code>string</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>pullPolicy</td><td><code>corev1.PullPolicy</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>command</td><td><code>[]string</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>volumeMounts</td><td><code>[]corev1.VolumeMount</code></td><td>No</td><td>-</td><td></td></tr><tr>
<td>securityContext</td><td><code>*corev1.SecurityContext</code></td><td>No</td><td>-</td><td></td></tr></tbody></table></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-064cf3669ed75479a61d9edba52b81d4">3 - Tail logfiles with a webhook</h1><p>The <code>tailer-webhook</code> is a different approach for the same problem: parsing legacy application&rsquo;s log file. As an alternative to using a <a href="/docs/configuration/extensions/kubernetes-host-tailer/">host file tailer</a> service, you can use a <code>file tailer webhook</code> service.
While the containers of the <code>host file tailers</code> run in a separated pod, <code>file tailer webhook</code> uses a different approach: if a pod has a specific annotation, the webhook injects a sidecar container for every tailed file into the pod.</p><p><img src="../logging-extensions-tailer-webhook.png" alt="Tailer-webhook"></p><p>The <code>tailer-webhook</code> behaves differently compared to the <code>host-tailer</code>:</p><p>Pros:</p><ul>
<li>A simple annotation on the pod initiates the file tailing.</li><li>There is no need to use <code>mounted volumes</code>, Logging operator will manage the volumes and mounts between your containers.</li></ul><p>Cons:</p><ul>
<li>Required to start the Logging operator with webhooks service enabled. This requires additional configuration, especially on certificates since webhook services are allowed over TLS only.</li><li>Possibly uses more resources, since every tailed file attaches a new sidecar container to the pod.</li></ul><h2 id="enable-webhooks">Enable webhooks in Logging operator</h2><blockquote>
<p>We recommend using <code>cert-manager</code> to manage your certificates. Since using <code>cert-manager</code> is not part of this article, we assume you already have valid certs.</p></blockquote><p>You will require the following things:</p><ul>
<li>a valid client certificate,</li><li>a CA certificate, and</li><li>a custom value.yaml file for your helm chart.</li></ul><p>The following example refers to a Kubernetes secret named <code>webhook-tls</code> which is a self-signed certificate generated by <code>cert-manager</code>.</p><p>Add the following lines to your custom <code>values.yaml</code> or create a new file if needed:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">env</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ENABLE_WEBHOOKS</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">value</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">volumes</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">webhook-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">secret</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">secretName</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">webhook-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">volumeMounts</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">webhook-tls</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">mountPath</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/tmp/k8s-webhook-server/serving-certs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This will:</p><ul>
<li>Set <code>ENABLE_WEBHOOKS</code> environment variable to <code>true</code>. This is the official way to enable webhooks in Logging operator.</li><li>Create a volume from the <code>webhook-tls</code> Kubernetes secret.</li><li>Mount the <code>webhook-tls</code> secret volume to the <code>/tmp/k8s-webhook-server/serving-certs</code> path where Logging operator will search for it.</li></ul><p>Now you are ready to install Logging operator with the new custom values:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging -f operator_values.yaml  logging-operator ./charts/logging-operator
</span></span></code></pre></div><p>Alternatively, instead of using the values.yaml file, you can run the installation from command line also by passing the values with the <code>set</code> and <code>set-string</code> parameters:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging --set <span style="color:#4e9a06">&#34;env[0].name=ENABLE_WEBHOOKS&#34;</span> --set-string <span style="color:#4e9a06">&#34;env[0].value=true&#34;</span> --set <span style="color:#4e9a06">&#34;volumes[0].name=webhook-tls&#34;</span> --set <span style="color:#4e9a06">&#34;volumes[0].secret.secretName=webhook-tls&#34;</span> --set <span style="color:#4e9a06">&#34;volumeMounts[0].name=webhook-tls&#34;</span> --set <span style="color:#4e9a06">&#34;volumeMounts[0].mountPath=/tmp/k8s-webhook-server/serving-certs&#34;</span>  logging-operator ./charts/logging-operator
</span></span></code></pre></div><p>You also need a service which points to the webhook port (9443) of Logging operator, and where the <code>mutatingwebhookconfiuration</code> will point to. Running the following command in shell will create the required service:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: v1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: Service
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: logging-webhooks
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  namespace: logging
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  ports:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    - name: logging-webhooks
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      port: 443
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      targetPort: 9443
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      protocol: TCP
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  selector:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    app.kubernetes.io/instance: logging-operator
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  type: ClusterIP
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Furthermore, you need to tell Kubernetes to send admission requests to our webhook service. To do that, create a <code>mutatingwebhookconfiguration</code> Kubernetes resource, and:</p><ul>
<li>Set the configuration to call <code>/tailer-webhook</code> path on your <code>logging-webhooks</code> service when <code>v1.Pod</code> is created.</li><li>Set <code>failurePolicy</code> to <code>ignore</code>, which means that the original pod will be created on webhook errors.</li><li>Set <code>sideEffects</code> to <code>none</code>, because we won&rsquo;t cause any out-of-band changes in Kubernetes.</li></ul><p>Unfortunately, <code>mutatingwebhookconfiguration</code> requires the <code>caBundle</code> field to be filled because we used a self-signed certificate, and the certificate cannot be validated through the system trust roots. If your certificate was generated with a system trust root CA, remove the <code>caBundle</code> line, because the certificate will be validated automatically.
There are more sophisticated ways to load the CA into this field, but this solution requires no further components.</p><blockquote>
<p>For example: you can inject the CA with a simple cert-manager <code>cert-manager.io/inject-ca-from: logging/webhook-tls</code> annotation on the <code>mutatingwebhookconfiguration</code> resource.</p></blockquote><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">apiVersion: admissionregistration.k8s.io/v1
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">kind: MutatingWebhookConfiguration
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  name: sample-webhook-cfg
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  namespace: logging
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  labels:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    app: sample-webhook
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">webhooks:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">  - name: sample-webhook.banzaicloud.com
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    clientConfig:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      service:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        name: logging-webhooks
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        namespace: logging
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        path: &#34;/tailer-webhook&#34;
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      caBundle: $(kubectl get secret webhook-tls -n logging -o json | jq -r &#39;.data[&#34;ca.crt&#34;]&#39;)
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    rules:
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">      - operations: [ &#34;CREATE&#34; ]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        apiVersions: [&#34;v1&#34;]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        resources: [&#34;pods&#34;]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">        scope: &#34;*&#34;
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    failurePolicy: Ignore
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    sideEffects: None
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">    admissionReviewVersions: [v1]
</span></span></span><span style="display:flex"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="triggering-the-webhook">Triggering the webhook</h2><div class="warning-block">
<p><strong>CAUTION:</strong></p>To use the webhook, you must first <a href="#enable-webhooks">enable webhooks in the Logging operator</a>.
</div><p><code>File tailer webhook</code> is based on a <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/"><code>Mutating Admission Webhook</code></a>. It is called every time when a pod starts.</p><p>To trigger the webhook, add the following annotation to the pod metadata:</p><ul>
<li>
<p>Annotation key: <code>sidecar.logging-extensions.banzaicloud.io/tail</code></p></li><li>
<p>Value of the annotation: the filename (including path, and optionally the container) you want to tail, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#204a87;font-weight:700">&#34;sidecar.logging-extensions.banzaicloud.io/tail&#34;: </span><span style="color:#4e9a06">&#34;/var/log/date&#34;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>To tail multiple files, add only one annotation, and separate the filenames with commas, for example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#204a87;font-weight:700">&#34;sidecar.logging-extensions.banzaicloud.io/tail&#34;: </span><span style="color:#4e9a06">&#34;/var/log/date,/var/log/mycustomfile&#34;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>If the pod contains multiple containers, see <a href="#multi-container-pods">Multi-container pods</a>.</p></li></ul><blockquote>
<p>Note: If the pod with the sidecar annotation is in the <code>default</code> namespace, Logging operator handles <code>tailer-webhook</code> annotations clusterwide. To restrict the webhook callbacks to the current namespace, change the <code>scope</code> of the <code>mutatingwebhookconfiguration</code> to <code>namespaced</code>.</p></blockquote><h3 id="file-tailer-example">File tailer example</h3><p>The following example creates a pod that is running a shell in infinite loop that appends the <code>date</code> command&rsquo;s output to a file every second. The annotation <code>sidecar.logging-extensions.banzaicloud.io/tail</code> notifies Logging operator to attach a sidecar container to the pod. The sidecar tails the <code>/legacy-logs/date.log</code> file and sends its output to the stdout.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">annotations</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#204a87;font-weight:700">&#34;sidecar.logging-extensions.banzaicloud.io/tail&#34;: </span><span style="color:#4e9a06">&#34;/var/log/date&#34;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">containers</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">debian</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample-container</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">command</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:700">[</span><span style="color:#4e9a06">&#34;/bin/sh&#34;</span><span style="color:#000;font-weight:700">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;-c&#34;</span><span style="color:#000;font-weight:700">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">args</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">while true; do</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">date &gt;&gt; /var/log/date;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">sleep 1;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">done</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:700">image</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">debian</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample-container2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>After you have created the pod with the required annotation, make sure that the <code>test-pod</code> contains two containers by running <code>kubectl get pod</code></p><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>NAME       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex"><span>test-pod   2/2     Running   <span style="color:#0000cf;font-weight:700">0</span>          29m
</span></span></code></pre></div><p>Check the container names in the pod to see that the Logging operator has created the sidecar container called <code>legacy-logs-date-log</code>. The sidecar containers&rsquo; name is always built from the path and name of the tailed file. Run the following command:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl get pod test-pod -o json <span style="color:#000;font-weight:700">|</span> jq <span style="color:#4e9a06">&#39;.spec.containers | map(.name)&#39;</span>
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">&#34;test&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">&#34;legacy-logs-date-log&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span></code></pre></div><p>Check the logs of the <code>test</code> container. Since it writes the logs into a file, it does not produce any logs on stdout.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs test-pod test<span style="color:#000;font-weight:700">;</span> <span style="color:#204a87">echo</span> <span style="color:#000">$?</span>
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#0000cf;font-weight:700">0</span>
</span></span></code></pre></div><p>Check the logs of the <code>legacy-logs-date-log</code> container. This container exposes the logs of the <code>test</code> container on its stdout.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl logs test-pod legacy-logs-date-log
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Fluent Bit v1.9.5
</span></span><span style="display:flex"><span>* Copyright <span style="color:#ce5c00;font-weight:700">(</span>C<span style="color:#ce5c00;font-weight:700">)</span> 2015-2022 The Fluent Bit Authors
</span></span><span style="display:flex"><span>* Fluent Bit is a CNCF sub-project under the umbrella of Fluentd
</span></span><span style="display:flex"><span>* https://fluentbit.io
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>fluent bit<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>1.9.5, <span style="color:#000">commit</span><span style="color:#ce5c00;font-weight:700">=</span>9ec43447b6, <span style="color:#000">pid</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>storage<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>1.2.0, <span style="color:#000">type</span><span style="color:#ce5c00;font-weight:700">=</span>memory-only, <span style="color:#000">sync</span><span style="color:#ce5c00;font-weight:700">=</span>normal, <span style="color:#000">checksum</span><span style="color:#ce5c00;font-weight:700">=</span>disabled, <span style="color:#000">max_chunks_up</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">128</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>cmetrics<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:700">=</span>0.3.4
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>sp<span style="color:#ce5c00;font-weight:700">]</span> stream processor started
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>input:tail:tail.0<span style="color:#ce5c00;font-weight:700">]</span> inotify_fs_add<span style="color:#ce5c00;font-weight:700">()</span>: <span style="color:#000">inode</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">938627</span> <span style="color:#000">watch_fd</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">1</span> <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:700">=</span>/legacy-logs/date.log
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>2022/09/15 11:26:11<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span> info<span style="color:#ce5c00;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">[</span>output:file:file.0<span style="color:#ce5c00;font-weight:700">]</span> worker <span style="color:#8f5902;font-style:italic">#0 started</span>
</span></span><span style="display:flex"><span>Thu Sep <span style="color:#0000cf;font-weight:700">15</span> 11:26:11 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>Thu Sep <span style="color:#0000cf;font-weight:700">15</span> 11:26:12 UTC <span style="color:#0000cf;font-weight:700">2022</span>
</span></span><span style="display:flex"><span>...
</span></span></code></pre></div><h2 id="multi-container-pods">Multi-container pods</h2><p>In some cases you have multiple containers in your pod and you want to distinguish which file annotation belongs to which container. You can order every file annotations to particular container by prefixing the annotation with a <code>${ContainerName}:</code> container key. For example:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>...
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>    name: test-pod
</span></span><span style="display:flex"><span>    annotations: <span style="color:#ce5c00;font-weight:700">{</span><span style="color:#4e9a06">&#34;sidecar.logging-extensions.banzaicloud.io/tail&#34;</span>: <span style="color:#4e9a06">&#34;sample-container:/var/log/date,sample-container2:/var/log/anotherfile,/var/log/mycustomfile,foobarbaz:/foo/bar/baz&#34;</span><span style="color:#ce5c00;font-weight:700">}</span>
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>...
</span></span></code></pre></div><div class="warning-block">
<p><strong>CAUTION:</strong></p><ul>
<li>Annotations without containername prefix: the file gets tailed on the default container (container 0)</li><li>Annotations with invalid containername: file tailer annotation gets discarded</li></ul></div><table>
<thead>
<tr>
<th>Annotation</th><th>Explanation</th></tr></thead><tbody>
<tr>
<td>sample-container:/var/log/date</td><td>tails file /var/log/date in sample-container</td></tr><tr>
<td>sample-container2:/var/log/anotherfile</td><td>tails file /var/log/anotherfile in sample-container2</td></tr><tr>
<td>/var/log/mycustomfile</td><td>tails file /var/log/mycustomfile in default container (sample-container)</td></tr><tr>
<td>foobarbaz:/foo/bar/baz</td><td>will be discarded due to non-existing container name</td></tr></tbody></table></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/kube-logging/logging-operator" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="https://banzaicloud.com/invite-slack/" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Discord" aria-label="Discord">
<a class="text-white" target="_blank" rel="noopener" href="https://discord.gg/9ACY4RDsYN" aria-label="Discord">
<i class="fab fa-discord"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white">&copy; 2023 kube-logging authors All Rights Reserved</small>
</div></div></div></footer></div><script src="/js/main.min.2aff983e9d0d8ecff9ed53e14b657216e2d8d2aff059bf4a5651283020995f1b.js" integrity="sha256-Kv+YPp0Njs/57VPhS2VyFuLY0q/wWb9KVlEoMCCZXxs=" crossorigin="anonymous"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
</body></html>